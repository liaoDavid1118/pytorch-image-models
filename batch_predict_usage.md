# æ‰¹é‡é¢„æµ‹è„šæœ¬ä½¿ç”¨æŒ‡å—

## ğŸ“‹ è„šæœ¬è¯´æ˜

æˆ‘ä¸ºæ‚¨åˆ›å»ºäº†ä¸¤ä¸ªæ‰¹é‡é¢„æµ‹è„šæœ¬ï¼š

1. **`batch_predict.py`** - åŠŸèƒ½å®Œæ•´çš„ä¸“ä¸šç‰ˆæœ¬
2. **`simple_batch_predict.py`** - ç®€åŒ–ç‰ˆæœ¬ï¼Œæ˜“äºä½¿ç”¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³•1: ä½¿ç”¨ç®€åŒ–ç‰ˆè„šæœ¬ (æ¨èæ–°æ‰‹)

```bash
# è¿è¡Œç®€åŒ–ç‰ˆè„šæœ¬
python simple_batch_predict.py
```

ç„¶åæŒ‰æç¤ºè¾“å…¥ï¼š
- å›¾ç‰‡æ–‡ä»¶å¤¹è·¯å¾„
- è¾“å‡ºæ–‡ä»¶å (å¯é€‰)

### æ–¹æ³•2: ä½¿ç”¨å®Œæ•´ç‰ˆè„šæœ¬

```bash
# åŸºç¡€ç”¨æ³• - é¢„æµ‹æ–‡ä»¶å¤¹
python batch_predict.py --model "./output_6class_gpu/six_class_gpu_training/model_best.pth.tar" --input "./test_images/"

# ä¿å­˜ç»“æœåˆ°CSV
python batch_predict.py --model "./output_6class_gpu/six_class_gpu_training/model_best.pth.tar" --input "./test_images/" --output "results.csv" --format csv

# é€’å½’é¢„æµ‹å­ç›®å½• + ç”ŸæˆæŠ¥å‘Š
python batch_predict.py --model "./output_6class_gpu/six_class_gpu_training/model_best.pth.tar" --input "./test_images/" --output "results.json" --recursive --report

# é¢„æµ‹å•å¼ å›¾ç‰‡
python batch_predict.py --model "./output_6class_gpu/six_class_gpu_training/model_best.pth.tar" --input "image.jpg"
```

## ğŸ“Š æ”¯æŒçš„åŠŸèƒ½

### å®Œæ•´ç‰ˆè„šæœ¬åŠŸèƒ½

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| å•å¼ å›¾ç‰‡é¢„æµ‹ | é¢„æµ‹å•å¼ å›¾ç‰‡å¹¶æ˜¾ç¤ºè¯¦ç»†ç»“æœ |
| æ–‡ä»¶å¤¹æ‰¹é‡é¢„æµ‹ | é¢„æµ‹æŒ‡å®šæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å›¾ç‰‡ |
| é€’å½’é¢„æµ‹ | é¢„æµ‹ç›®å½•åŠæ‰€æœ‰å­ç›®å½•ä¸­çš„å›¾ç‰‡ |
| å¤šç§è¾“å‡ºæ ¼å¼ | æ”¯æŒJSONã€CSVã€Excelæ ¼å¼ |
| ç»Ÿè®¡æŠ¥å‘Š | ç”Ÿæˆè¯¦ç»†çš„é¢„æµ‹ç»Ÿè®¡æŠ¥å‘Š |
| GPUåŠ é€Ÿ | è‡ªåŠ¨æ£€æµ‹å¹¶ä½¿ç”¨GPUåŠ é€Ÿ |
| è¿›åº¦æ˜¾ç¤º | æ˜¾ç¤ºé¢„æµ‹è¿›åº¦æ¡ |

### ç®€åŒ–ç‰ˆè„šæœ¬åŠŸèƒ½

| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| æ–‡ä»¶å¤¹æ‰¹é‡é¢„æµ‹ | é¢„æµ‹æŒ‡å®šæ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰å›¾ç‰‡ |
| äº¤äº’å¼è¾“å…¥ | å‹å¥½çš„ç”¨æˆ·äº¤äº’ç•Œé¢ |
| è‡ªåŠ¨ç»Ÿè®¡ | è‡ªåŠ¨ç”Ÿæˆç±»åˆ«åˆ†å¸ƒç»Ÿè®¡ |
| CSVè¾“å‡º | è‡ªåŠ¨ä¿å­˜ä¸ºCSVæ ¼å¼ |

## ğŸ“ è¾“å‡ºæ ¼å¼è¯´æ˜

### CSVè¾“å‡ºæ ¼å¼
```csv
image_name,predicted_class,confidence,inference_time_ms,prob_bilei,prob_fuban,prob_genbu,prob_mengpi,prob_qianhou,prob_waiguan
image1.jpg,bilei,0.987,12.3,0.987,0.008,0.002,0.001,0.001,0.001
image2.jpg,waiguan,0.945,11.8,0.012,0.015,0.008,0.010,0.010,0.945
```

### JSONè¾“å‡ºæ ¼å¼
```json
[
  {
    "image_path": "/path/to/image1.jpg",
    "image_name": "image1.jpg",
    "predicted_class": "bilei",
    "predicted_index": 0,
    "confidence": 0.987,
    "inference_time_ms": 12.3,
    "probabilities": {
      "bilei": 0.987,
      "fuban": 0.008,
      "genbu": 0.002,
      "mengpi": 0.001,
      "qianhou": 0.001,
      "waiguan": 0.001
    },
    "timestamp": "2025-01-02T10:30:45"
  }
]
```

## ğŸ¯ 6ä¸ªç±»åˆ«è¯´æ˜

| ç±»åˆ« | ä¸­æ–‡åç§° | è¯´æ˜ |
|------|----------|------|
| bilei | é¼»æ³ª | é¼»æ³ªç›¸å…³ç‰¹å¾ |
| fuban | è…¹æ–‘ | è…¹éƒ¨æ–‘çº¹ç‰¹å¾ |
| genbu | è·Ÿéƒ¨ | è·Ÿéƒ¨ç›¸å…³ç‰¹å¾ |
| mengpi | è’™çš® | è’™çš®ç›¸å…³ç‰¹å¾ |
| qianhou | å‰å | å‰åä½ç½®ç‰¹å¾ |
| waiguan | å¤–è§‚ | å¤–è§‚æ•´ä½“ç‰¹å¾ |

## ğŸ“ˆ æ€§èƒ½å‚æ•°

### GPUæ€§èƒ½ (RTX 3060)
- **æ¨ç†é€Ÿåº¦**: ~3-5ms/å¼ 
- **æ‰¹æ¬¡å¤„ç†**: æ”¯æŒæ‰¹é‡åŠ é€Ÿ
- **å†…å­˜å ç”¨**: ~2GBæ˜¾å­˜

### CPUæ€§èƒ½
- **æ¨ç†é€Ÿåº¦**: ~15-30ms/å¼ 
- **å†…å­˜å ç”¨**: ~1GBå†…å­˜

## ğŸ› ï¸ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1: å¿«é€Ÿæ‰¹é‡é¢„æµ‹
```bash
# ä½¿ç”¨ç®€åŒ–ç‰ˆè„šæœ¬
python simple_batch_predict.py

# è¾“å…¥ç¤ºä¾‹:
# è¯·è¾“å…¥å›¾ç‰‡æ–‡ä»¶å¤¹è·¯å¾„: ./test_images
# è¯·è¾“å…¥è¾“å‡ºæ–‡ä»¶å (å¯é€‰ï¼Œç›´æ¥å›è½¦è·³è¿‡): my_results.csv
```

### ç¤ºä¾‹2: ä¸“ä¸šæ‰¹é‡é¢„æµ‹
```bash
# é¢„æµ‹æµ‹è¯•é›†å¹¶ç”Ÿæˆå®Œæ•´æŠ¥å‘Š
python batch_predict.py \
    --model "./output_6class_gpu/six_class_gpu_training/model_best.pth.tar" \
    --input "./dataset/test" \
    --output "test_results.csv" \
    --format csv \
    --report
```

### ç¤ºä¾‹3: é€’å½’é¢„æµ‹å¤šä¸ªå­ç›®å½•
```bash
# é€’å½’é¢„æµ‹æ‰€æœ‰å­ç›®å½•
python batch_predict.py \
    --model "./output_6class_gpu/six_class_gpu_training/model_best.pth.tar" \
    --input "./all_images" \
    --output "all_results.excel" \
    --format excel \
    --recursive \
    --report
```

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

### æ§åˆ¶å°è¾“å‡ºç¤ºä¾‹
```
ğŸ¯ 6ç±»åˆ«å›¾åƒåˆ†ç±»æ‰¹é‡é¢„æµ‹
==================================================
ğŸš€ åˆå§‹åŒ–æ‰¹é‡é¢„æµ‹å™¨...
ğŸ“± è®¾å¤‡: cuda
ğŸ·ï¸  ç±»åˆ«æ•°: 6
ğŸ“‚ æ¨¡å‹è·¯å¾„: ./output_6class_gpu/six_class_gpu_training/model_best.pth.tar
âœ… æ¨¡å‹åŠ è½½æˆåŠŸ!
ğŸ“ è¾“å…¥å°ºå¯¸: (3, 224, 224)

ğŸ“ æ‰¾åˆ° 152 å¼ å›¾ç‰‡
é¢„æµ‹è¿›åº¦: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 152/152 [00:08<00:00, 18.2it/s]
âœ… é¢„æµ‹å®Œæˆ: æˆåŠŸ 152 å¼ , å¤±è´¥ 0 å¼ 

ğŸ“ˆ é¢„æµ‹ç»Ÿè®¡:
ğŸ“¸ æ€»å›¾ç‰‡æ•°: 152
âœ… æˆåŠŸé¢„æµ‹: 152
âŒ å¤±è´¥é¢„æµ‹: 0
ğŸ“Š æˆåŠŸç‡: 100.0%

ğŸ·ï¸  ç±»åˆ«åˆ†å¸ƒ:
   bilei: 25 å¼ 
   fuban: 24 å¼ 
   genbu: 26 å¼ 
   mengpi: 25 å¼ 
   qianhou: 26 å¼ 
   waiguan: 26 å¼ 

âš¡ æ€§èƒ½ç»Ÿè®¡:
   å¹³å‡ç½®ä¿¡åº¦: 0.847
   å¹³å‡æ¨ç†æ—¶é—´: 4.2ms
   æ€»æ¨ç†æ—¶é—´: 638.4ms

ğŸ’¾ CSVç»“æœå·²ä¿å­˜: test_results.csv
ğŸ“Š ç»Ÿè®¡æŠ¥å‘Šå·²ä¿å­˜: test_results.report.json
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ¨¡å‹è·¯å¾„**: ç¡®ä¿æ¨¡å‹æ–‡ä»¶è·¯å¾„æ­£ç¡®
2. **å›¾ç‰‡æ ¼å¼**: æ”¯æŒ JPG, PNG, BMP, TIFF æ ¼å¼
3. **GPUå†…å­˜**: å¤§æ‰¹é‡é¢„æµ‹æ—¶æ³¨æ„GPUå†…å­˜ä½¿ç”¨
4. **æ–‡ä»¶æƒé™**: ç¡®ä¿æœ‰è¾“å‡ºç›®å½•çš„å†™å…¥æƒé™
5. **ä¾èµ–åº“**: éœ€è¦å®‰è£… pandas, tqdm ç­‰ä¾èµ–

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¨¡å‹åŠ è½½å¤±è´¥**
   ```
   è§£å†³æ–¹æ¡ˆ: æ£€æŸ¥æ¨¡å‹æ–‡ä»¶è·¯å¾„å’Œæƒé™
   ```

2. **CUDAå†…å­˜ä¸è¶³**
   ```bash
   # ä½¿ç”¨CPUæ¨¡å¼
   python batch_predict.py --device cpu ...
   ```

3. **å›¾ç‰‡æ ¼å¼ä¸æ”¯æŒ**
   ```
   è§£å†³æ–¹æ¡ˆ: è½¬æ¢ä¸ºæ”¯æŒçš„æ ¼å¼ (JPG, PNGç­‰)
   ```

4. **ä¾èµ–åº“ç¼ºå¤±**
   ```bash
   pip install pandas tqdm openpyxl
   ```

## ğŸ‰ ä½¿ç”¨å»ºè®®

1. **é¦–æ¬¡ä½¿ç”¨**: æ¨èä½¿ç”¨ `simple_batch_predict.py`
2. **å¤§æ‰¹é‡å¤„ç†**: ä½¿ç”¨å®Œæ•´ç‰ˆè„šæœ¬çš„é€’å½’åŠŸèƒ½
3. **ç»“æœåˆ†æ**: å¯ç”¨ `--report` å‚æ•°ç”Ÿæˆè¯¦ç»†ç»Ÿè®¡
4. **æ€§èƒ½ä¼˜åŒ–**: åœ¨GPUç¯å¢ƒä¸‹è¿è¡Œä»¥è·å¾—æœ€ä½³æ€§èƒ½

ç°åœ¨æ‚¨å¯ä»¥è½»æ¾åœ°å¯¹ä»»æ„æ•°é‡çš„å›¾ç‰‡è¿›è¡Œæ‰¹é‡åˆ†ç±»é¢„æµ‹ï¼
